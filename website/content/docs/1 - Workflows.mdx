---
title: Workflows
id: workflows
globalReference: docs-workflows
---

import { GithubLabel } from "/src/components/GithubLabel.tsx";

# Workflows

This section covers documentation on all github workflows in the repository.

All workflows are in `./.github/workflows`.

## Auto Assign Author

This workflow automatically assigns the author of the PR as the assignee unless the assignees were otherwise specified.

Info:

- File: `auto_assign_author.yaml`
- Runs on: pull_request.opened, pull_request.reopened

## Check for Release

This workflow stops a pull request which when merged would result in a new release from being merged automatically.

The workflow checks if the app version or Helm chart version in the Chart.yaml changed.
This would result in a new release if the pull request were to be merged.

If merging the PR would result in a new release the <GithubLabel label="needs approval"/> label will be added to it.
Additionally a message warning about this and explaining the steps needed to merge will be sent in the pull request.

The pull request can not be merged until the <GithubLabel label="new release"/> label gets added to the PR.
After that the <GithubLabel label="needs approval"/> label will get removed automatically and the PR can be merged.

Info:

- File: `check_for_release.yaml`
- Runs on: pull_request.opened, pull_request.synchronize, pull_request.labeled, pull_request.unlabeled

## Check Version

This workflow starts the release process automatically if the app version or Helm chart version in the Chart.yaml changed.

The workflow checks if the app version or Helm chart version in the Chart.yaml changed.
If it did the workflow will run a repository dispatch event to
build a new helm chart([`build-new-chart` event](#build-new-chart-event)) and
create a new release([`release-new-version` event](#release-new-version-event)).

Info:

- File: `check_version.yaml`
- Runs on: push.branches == main && push.paths == deployments/chart/Chart.yaml

## Create Dev Build

This workflow creates a new dev build of the downscaler when triggered manually.

The workflow extracts the helm chart version and the app version from the Chart.yaml.
It then triggers the [`create-dev-build` repository dispatch event](#create-dev-build-event).

Info:

- File: `create_dev_build.yaml`
- Runs on: workflow_dispatch

## Create Release

This workflow creates a new release in github when the [`release-new-version` event](#release-new-version-event) is triggered.

The workflow creates the release with the name of the app version,
pointing to the tag for the app version and with autogenerated release notes.

Info:

- File: `create_release.yaml`
- Runs on: repository_dispatch.types == `release-new-version`

## Deploy Website

This workflow deploys the website to github pages when website changes are merged into main.

The workflow installs the dependencies needed to build the website,
builds the website and uploads the artifacts.
Before deploying to github pages it deletes the previous deployments as they are no longer needed.
Finally it deploys the built website artifacts to github pages.

Info:

- File: `deploy_website.yaml`
- Runs on: push.branches == main && push.paths == website/\*\*

## Docker Build

This workflow builds [the docker image for the downscaler](ref:docs-docker-image)
when the [`release-new-version` event](#release-new-version-event) or the [`create-dev-build` event](#create-dev-build-event) is triggered.

The workflow sets up Cosign and Docker Buildx.
Additionally it logs in to the GitHub Container Registry(GHCR) and Telekom's Magenta Trusted Registry(MTR).
After which it builds the image and pushes it to both container registries.
Finally it signs the image with Cosign.

Info:

- File: `docker_build.yaml`
- Runs on: repository_dispatch.types == `release-new-version`, repository_dispatch.types == `create-dev-build`

## Helm Build

This workflow builds the helm chart for the downscaler when the [`build-new-chart` event](#build-new-chart-event) is triggered.

The workflow installs Helm as its needed to build the helm chart,
lints the helm chart, packages the helm chart and pushes it to
the GitHub Container Registry(GHCR) and Telekom's Magenta Trusted Registry(MTR).
Additionally it also triggers a repository dispatch event on
the [helm-charts repo](https://github.com/caas-team/helm-charts) which adds the new helm chart to the helm-charts repo.

Info:

- File: `helm_build.yaml`
- Runs on: repository_dispatch.types == `build-new-chart`, repository_dispatch.types == `create-dev-build`

## Pre Commit

This workflow runs the pre-commit checks of the downscaler on every push to the repository.

The workflow installs the dependencies needed for the pre-commit checks.
It then updates the pre-commit hooks and finally runs the pre-commit checks.

Info:

- File: `pre_commit.yaml`
- Runs on: push, pull_request.opened, pull_request.synchronize, pull_request.reopened

## Events

### Build-New-Chart Event

Info:

- Triggered by: [Check Version workflow](#check-version) if the helm chart version changed
- Triggers: [Helm Build workflow](#helm-build)

Payload:

| Key        | Type   | Description                        |
| ---------- | ------ | ---------------------------------- |
| version    | string | The new version of the Helm chart. |
| appVersion | string | The version of the application.    |

### Release-New-Version Event

Info:

- Triggered by: [Check Version workflow](#check-version) if the app version changed
- Triggers: [Create Release workflow](#create-release), [Docker Build workflow](#docker-build)

Payload:

| Key        | Type   | Description                                    |
| ---------- | ------ | ---------------------------------------------- |
| appVersion | string | The new version of the application.            |
| setLatest  | bool   | If the new release should be marked as latest. |

### Create-Dev-Build Event

Info:

- Triggered by: [Create Dev Build workflow](#create-dev-build)
- Triggers: [Docker Build workflow](#docker-build), [Helm Build workflow](#helm-build)

Payload:

| Key        | Type   | Description                                    |
| ---------- | ------ | ---------------------------------------------- |
| version    | string | The new version of the application.            |
| appVersion | string | The version of the application.                |
| setLatest  | bool   | If the new release should be marked as latest. |
